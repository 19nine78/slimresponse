# ResponsivePresets for ImageResizer.Net [BETA!]
**Vary ImageResizer preset names by client resolution for automatic image resizing according to responsive webdesign practices.**

---

##Introduction
Licensed under the [MIT Licence](http://www.opensource.org/licenses/mit-license.php), which allows open source as well as commercial use.

### Requirements
* .Net 4.0
* ImageResizer.Net 3.1.5+

### Components
* ResponsivePresets-ImageResizer.js: client-side javascript library
* ResponsivePresets.dll
  * ImageResizer Plugin (presets extension)
  * ResponsivePresetsFilterModule (for cookie-less requests)

### Spin it up quickly for a test!
* Use WebMatrix and fire it up on the "www"-folder, that's all!

----

## How to use

ResponsivePresets extends the presets that are available with ImageResizer. **With a simple dot-notation, you can enable screen resolution aware dynamic resizing for some or all your images.**

### 1. Enable ResponsivePresets plugin

ResponsivePresets works in team with the standard Presets plugin for ImageResizer, so you need to enable and configure that as well. Deploy the assembly and activate the plugin:
* Copy ResponsivePresets.dll to /bin/
* Copy HtmlAgilityPack.dll to /bin/
* Enable the plugin in web.config (or exteral configuration file) by adding `<add name="ResponsivePresets" />` to the plugins section of ImageResizer. In case you've never done that before, here's a snippet to get you started:

```xml
<resizer>  
	<plugins>  
		<add name="Presets" />  
		<add name="ResponsivePresets" />  
	</plugins>  
</resizer>  
```
Install the HttpModule to handle cookie-less requests (either first page hit or i.e. search engine crawlers) in `<system.webServer>`, `<modules>`:

```xml
<add name="ResponsivePresetsFilterModule" type="ResponsivePresets.FilterModule.RegisterFilterModule, ResponsivePresets"/>
```

For a working example see web.config and ImageResizer.config in /www/

### 2. Segment device screen resolutions
The concept for ResponsivePresets is to group screen resolutions in classes that get prefixed to the base preset name.

```xml
<responsivepresets>
	<preset prefix="mobile" minwidth="0" maxwidth="480" />
	<preset prefix="tablet" minwidth="481" maxwidth="1440" />
	<preset prefix="desktop" minwidth="1441" maxwidth="2559" />
	<preset prefix="hires" minwidth="2560" maxwidth="0" />
</responsivepresets>
```
 
Define which prefix will be used for which range of the screen width. The list is processed top to bottom, first match wins. This values do **not** resize images to these widths, but segment the devices by their available screen width.
 
You are free to segment and structure to your liking, this allows ResponsivePresets to adapt to almost any requirement.

### 3. Configure presets
Add a preset to your config, like you would normally do for the presets plugin:
    
```xml
<preset name="galleryimage" settings="width=800" />
```

If this setting is i.e. for tablet devices (and high-resolution smartphones), prefix the preset name with *tablet.* like so:
    
```xml
<preset name="tablet.galleryimage" settings="width=800" />
```

Add presets for all the other prefixes (device segments)
    
```xml
<preset name="mobile.galleryimage" settings="width=400" />
<preset name="tablet.galleryimage" settings="width=800" />
<preset name="desktop.galleryimage" settings="width=1500" />
<preset name="hires.galleryimage" settings="width=2400" />
```

Lastly add an init preset, that renders a suitable fallback variant of the image. Useragents (especially crawlers and bots) that don't support javascript and/or cookies will receive these preset. Preferably use a setting that makes the image rank within the Google image index (not too small) and set a high compression (low quality). This way the thumbnail generated by Google will look very good, while the filesize is relatively low. As the live site is shown next to the image thumbnail, when a user clicks on a search result, the ResponsivePresets replacement will kick in and show an even better image (i.e. "desktop").

```xml
<preset name=".galleryimage" settings="width=800&amp;quality=20&amp;format=jpg" />
```

Useragents that support javascript will request the most suitable higher-level variant of the image right **after** the page/DOM is ready (and the low-resolution variant was already loaded). This extra traffic happens **only for the first pageview**. After that any subsequent image requests will check the resolution cookie and deliver the matching preset for the resolution.

**Tipp**
>If you are not interested in having your images listed with search engines and don't care about useragents without javascript support, try a setting that produces super-tiny images on first hit. Like so:

```xml
<preset name=".galleryimage" settings="width=2&amp;quality=1&amp;format=jpg" />
```

### 4. Prepare your markup
* Reference the (minified) client library for ResponsivePresets:

```html
	<script src="/ResponsivePresets-ImageResizer.min.js"></script>
```

* Adjust image source attribute: Instead of adding a fixed preset name to the image's request string, write the base preset name and prepend a dot to indicate you want this image to be extended by ResponsivePresets:

```html
	<img src="sample.jpg?preset=.galleryimage" alt="sample image"/>
```

**Note**
>Your stylesheet has to take care to resize the images to the desired dimensions, they now greatly vary depending on the client's screen resolution.

----

## Limitations

#### Javascript and cookies vs. crawlers, bots and SEO
To assist placing your images on i.e. Google Image/Universal Search, choose a set of suitable preset values for init and fallback, like explained above.

#### Use of cookies
ResponsivePresets **uses cookies to speed up subsequent requests** of the same client and also to minimize the of bandwidth. ResponsivePresets **will work nonetheless if cookies are not available** (or disabled). 

#### Very small browser window receiving desktop or hires images
Due to the nature that ResponsivePresets uses the requesting device's screen resolution to determine how to resize the image, making the browser window smaller will still get you "big images". Your system is still capable of a higher resolution, you simply aren't using it. Because many i.e. portable devices can be rotated, ResponsivePresets doesn't use the viewport size but the maximum available resolution the client is capable as ways to to determine the suitable preset. This has drawbacks and side effects, but works quite well and the overall improvement of the user's experience is greatly enhanced by using ResponsiovePresets.

*Don't just make your desktop browser's window smaller: You simply can't test this way!* Better use a real i.e. mobile device like an iPhone or Nokia Lumia or a tablet like an ASUS Transformer or iPad. Of course you can also lower your screen resolution settings or use a VM or mobile emulator (i.e. Windows Phone Emulator, iPhone Simulator)

----

Follow [esn303](https://twitter.com/#!/esn303) on twitter

This project is open to collaboration. **Fork. Push. Innovate.**


